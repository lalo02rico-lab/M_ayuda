<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Asignación de Tickets</title>

  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/admin_tickets.css">
  <link rel="stylesheet" href="/css/responsive.css">
</head>

<body>

<!-- HEADER -->
<header class="app-header">
  <div class="header-container">
    <img src="/img/logo_gobierno.png" alt="Gobierno del Estado de México">
    <a href="/logout" class="btn-logout">Cerrar sesión</a>
  </div>
</header>

<!--  CONTENEDOR CORRECTO -->
<main class="layout admin-tickets">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="user-box">
      <div class="user-icon">
        <img src="/img/logo_usuario.png" alt="Usuario">
      </div>
      <div class="user-role">ADMINISTRADOR</div>
    </div>

    <nav class="menu">
      <a href="/admin/dashboard">Dashboard</a>
      <a href="/admin/tickets" class="active">Asignación de tickets</a>
      <a href="/admin/menu">⬅ Volver</a>
    </nav>
  </aside>

  <!-- CONTENIDO -->
  <section class="content admin-asignacion">


  <div class="search-box">
      <input type="text" id="buscar" onkeyup="filtrar()" placeholder="Buscar...">
    </div>

    <div class="tabla-container" th:if="${!#lists.isEmpty(tickets)}">
      <table class="tabla">
        <thead>
        <tr>
          <th>Nombre</th>
          <th>Área</th>
          <th>Descripción</th>
          <th>Fecha</th>
          <th>Nivel</th>
          <th>Técnico</th>
          <th>Estado</th>
          <th>Acción</th>
        </tr>
        </thead>

        <tbody id="tbodyTickets">
        <tr th:each="t : ${tickets}">
          <td th:text="${t.preSolicitud.nombre}"></td>
          <td th:text="${t.preSolicitud.departamento.nombreDepartamento}"></td>
          <td th:text="${t.descripcion}"></td>
          <td th:text="${#dates.format(t.fechaHora, 'dd/MM/yyyy HH:mm')}"></td>

          <td>
            <span class="nivel"
                  th:classappend="${t.nivelAtencion == 'BAJO' ? 'nivel-bajo' :
                               t.nivelAtencion == 'MEDIO' ? 'nivel-medio' :
                               'nivel-alto'}"
                  th:text="${t.nivelAtencion}">
            </span>
          </td>

          <td>
            <form method="post" th:action="@{/admin/asignar}">
              <select name="idTecnico" required>
                <option value="">Seleccionar</option>
                <option th:each="tec : ${tecnicos}"
                        th:value="${tec.idUsuario}"
                        th:text="${tec.nombreUsuario}">
                </option>
              </select>
          </td>

          <td>
            <span th:switch="${t.idEstado}">
              <span th:case="1">Nuevo</span>
              <span th:case="2">Asignado</span>
              <span th:case="3">En proceso</span>
              <span th:case="4">Pendiente</span>
              <span th:case="5">Finalizado</span>
            </span>
          </td>

          <td>
            <input type="hidden" name="idTicket" th:value="${t.idTicket}">
            <button class="btn-asignar">Asignar</button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div class="no-tickets" th:if="${#lists.isEmpty(tickets)}">
      No hay tickets nuevos para asignar.
    </div>

  </section>
</main>

<footer class="app-footer">
  <p>©2025/6  - Subdirección de Desarrollo Tecnológico</p>
</footer>

<script>
  function filtrar() {
    const filtro = document.getElementById("buscar").value.toLowerCase();
    document.querySelectorAll("#tbodyTickets tr").forEach(fila => {
      fila.style.display = fila.innerText.toLowerCase().includes(filtro) ? "" : "none";
    });
  }
</script>

</body>
</html>
